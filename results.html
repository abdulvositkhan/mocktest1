<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Test Natijalari</title>

<style>
*{box-sizing:border-box;font-family:Inter,Arial,sans-serif}
body{
  margin:0;
  min-height:100vh;
  background:linear-gradient(135deg,#eef2ff,#ecfdf5);
  padding:30px;
}
.container{
  max-width:1200px;
  margin:auto;
  background:#fff;
  padding:32px;
  border-radius:28px;
  box-shadow:0 40px 100px rgba(0,0,0,.15);
}
h1{text-align:center;font-size:32px;font-weight:900}

.test-list{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  justify-content:center;
  margin-bottom:24px;
}
.test-btn{
  padding:10px 18px;
  border-radius:999px;
  border:none;
  cursor:pointer;
  font-weight:800;
  background:#e0e7ff;
}
.test-btn.active{
  background:#6366f1;
  color:#fff;
}

.table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:14px;
  border-bottom:1px solid #e5e7eb;
  text-align:center;
}
th{background:#f1f5f9}

.score{
  padding:6px 16px;
  border-radius:999px;
  font-weight:900;
}
.blue{background:#dbeafe;color:#1d4ed8}
.yellow{background:#fef9c3;color:#854d0e}
.orange{background:#ffedd5;color:#9a3412}
.red{background:#fee2e2;color:#991b1b}

.footer{text-align:center;margin-top:30px;font-weight:900;color:#4f46e5}
</style>
</head>

<body>

<div class="container">
  <h1>ðŸ“Š Test Natijalari (Admin)</h1>

  <div id="tests" class="test-list"></div>

  <table class="table">
    <thead>
      <tr>
        <th>#</th>
        <th>Ism</th>
        <th>Familiya</th>
        <th>Ball</th>
        <th>Vaqt</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>

  <div class="footer">@Ped_Life_Uz</div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyDMyRSvTXXxkgTPyeZSeVnpHgh1tH4lJjE",
  authDomain:"mock-8b900.firebaseapp.com",
  projectId:"mock-8b900"
});
const db=firebase.firestore();

sessionStorage.setItem("viewer","admin"); // ðŸ”’ MAJBURIY ADMIN

const rows=document.getElementById("rows");
const testsDiv=document.getElementById("tests");

let allResults=[];
let currentTest=null;

db.collection("results")
  .orderBy("ball","desc")
  .get()
  .then(snap=>{
    snap.forEach(d=>allResults.push(d.data()));
    renderTests();
  });

function renderTests(){
  const testIds=[...new Set(allResults.map(r=>r.testId))];
  testsDiv.innerHTML="";
  testIds.forEach(id=>{
    const btn=document.createElement("button");
    btn.className="test-btn";
    btn.innerText=id;
    btn.onclick=()=>selectTest(id,btn);
    testsDiv.appendChild(btn);
  });
}

function selectTest(id,btn){
  currentTest=id;
  document.querySelectorAll(".test-btn").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  renderTable();
}

function renderTable(){
  rows.innerHTML="";
  const list=allResults.filter(r=>r.testId===currentTest);

  list.forEach((r,i)=>{
    let cls="red";
    if(r.ball>=80) cls="blue";
    else if(r.ball>=70) cls="yellow";
    else if(r.ball>=60) cls="orange";

    rows.innerHTML+=`
      <tr>
        <td>${i+1}</td>
        <td>${r.ism}</td>
        <td>${r.familiya}</td>
        <td><span class="score ${cls}">${r.ball} ball</span></td>
        <td>${r.time}</td>
      </tr>
    `;
  });
}
</script>

</body>
</html>
