<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Test topshirish</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#ecfdf5; /* juda och yashil */
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

.container{
  width:100%;
  max-width:900px;
  background:#ffffff;
  padding:30px;
  border-radius:20px;
  box-shadow:0 15px 40px rgba(0,0,0,0.15);
}

.timer{
  text-align:right;
  font-size:18px;
  font-weight:bold;
  color:#dc2626;
}

.question-box{
  border:2px solid #e5e7eb;
  border-radius:16px;
  padding:25px;
  font-size:22px;
  font-weight:600;
  margin:20px 0;
}

.option{
  border:1.5px solid #d1d5db;
  border-radius:12px;
  padding:14px;
  margin:12px 0;
  font-size:18px;
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:10px;
}

.option:hover{
  background:#f0fdf4;
}

.nav{
  display:flex;
  justify-content:space-between;
  margin-top:25px;
}

button{
  padding:14px 26px;
  border:none;
  border-radius:12px;
  background:#4f46e5;
  color:white;
  font-size:16px;
  font-weight:bold;
  cursor:pointer;
}

.finish{
  width:100%;
  margin-top:25px;
  background:#16a34a;
}

.result{
  text-align:center;
  font-size:30px;
  font-weight:bold;
  padding:40px;
  border-radius:20px;
  margin-top:20px;
}

.red{background:#fee2e2;color:#991b1b}
.orange{background:#ffedd5;color:#9a3412}
.yellow{background:#fef9c3;color:#854d0e}
.blue{background:#dbeafe;color:#1e3a8a}
</style>
</head>
<body>

<div class="container">

  <div class="timer" id="timer"></div>

  <div id="testArea">
    <div class="question-box" id="questionText"></div>
    <div id="options"></div>

    <div class="nav">
      <button onclick="prevQuestion()">⬅ Oldingi</button>
      <button onclick="nextQuestion()">Keyingi ➡</button>
    </div>

    <button class="finish" onclick="finishTest()">TESTNI YAKUNLASH</button>
  </div>

  <div id="resultArea"></div>

</div>

<script>
// === MA'LUMOTLAR ===
const testId = localStorage.getItem("currentTestId");
const allTests = JSON.parse(localStorage.getItem("allTests")) || {};
const test = allTests[testId];

if(!test){
  alert("Test topilmadi");
  location.href="taker.html";
}

let current = 0;
let answers = {};
let timeLeft = test.duration * 60;

// === TIMER ===
const timerEl = document.getElementById("timer");
setInterval(()=>{
  const m = Math.floor(timeLeft / 60);
  const s = timeLeft % 60;
  timerEl.innerText = `⏱ ${m}:${String(s).padStart(2,"0")}`;
  timeLeft--;
  if(timeLeft < 0) finishTest();
},1000);

// === SAVOL CHIQARISH ===
function renderQuestion(){
  const q = test.questions[current];
  document.getElementById("questionText").innerText =
    `${current+1}. ${q.text}`;

  const optDiv = document.getElementById("options");
  optDiv.innerHTML = "";

  for(const key in q.options){
    optDiv.innerHTML += `
      <label class="option">
        <input type="radio" name="option" value="${key}"
          ${answers[current]===key?"checked":""}>
        ${key}) ${q.options[key]}
      </label>
    `;
  }

  document.querySelectorAll("input[name=option]").forEach(r=>{
    r.onchange = () => answers[current] = r.value;
  });
}
renderQuestion();

function nextQuestion(){
  if(current < test.questions.length-1){
    current++;
    renderQuestion();
  }
}

function prevQuestion(){
  if(current > 0){
    current--;
    renderQuestion();
  }
}

// === TESTNI YAKUNLASH ===
function finishTest(){
  let correct = 0;
  test.questions.forEach((q,i)=>{
    if(answers[i] === q.correct) correct++;
  });

  const score = correct * 2;
  let title="O‘tilmadi", cls="red";

  if(score>=80){title="Oliy toifa";cls="blue";}
  else if(score>=70){title="Birinchi toifa";cls="yellow";}
  else if(score>=60){title="Ikkinchi toifa";cls="orange";}

  document.getElementById("testArea").style.display="none";

  document.getElementById("resultArea").innerHTML = `
    <div class="result ${cls}">
      ${score}/100<br>
      ${title}
    </div>
  `;
}
</script>

</body>
</html>
